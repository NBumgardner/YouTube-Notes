<link rel="import" href="node_modules/@polymer/polymer/polymer.html" />

<dom-module id="youtube-notes">

  <template>
    <style>
      h1 {
        color: maroon;
      }
      header {
        background: #fff;
      }
    </style>
    <header>
      <h1>YouTube Notes</h1>
      <nav>
        <a href="/choose-video">Choose Video</a>
        <a href="/watch-video">Watch Video</a>
        <a href="/save-notes">Load/Save Notes</a>
      </nav>
    </header>

    <template is="dom-if" if="{{flagList_}}">
      <div>Choose Video content</div>
      <p>
        <label><input type="text" id="search_bar" size="72"
          value=""> <button>Search</button></label>
      </p>
      <!-- TODO: Search button dynamically inserts videos into the list below. -->
      <ul class="video-list"></ul>
    </template>

    <template is="dom-if" if="{{flagVideo_}}">
      <div>Watch Video content</div>
      <div id="ytplayer_wrapper">
      <iframe id="ytplayer" type="text/html" width="640" height="390"
        src="http://www.youtube.com/embed/M7lc1UVf-VE?autoplay=1&origin=http://localhost:8080&enablejsapi=1"
        frameborder="0"></iframe>
      </div>
    </template>

    <template is="dom-if" if="{{flagNotes_}}">
      <article>
        <div>Save Notes content</div>
        <p>
          <strong>Notes</strong>
          <label><input type="checkbox" id="edit_text"
            value="edit_text_value"> Unlocked {{flagNotes_}}</label>
          <button>Copy to Clipboard</button>
        </p>
        <textarea rows="8" cols="80"></textarea>
      </article>
    </template>

    <p>Footer</p>

  </template>

  <script>
    // element registration
    Polymer({
      is: 'youtube-notes',

      // add properties and methods on the element's prototype
      properties: {
        // declare properties for the element's public API
        user: Object,

        APIKey_: {
          type: String,
          value: ""
        },

        // 3 flags to enable and disable above templates.
        flagList_: {
          type: Boolean,
          value: false
        },
        flagVideo_: {
          type: Boolean,
          value: false
        },
        flagNotes_: {
          type: Boolean,
          value: false
        }
      },

      pauseYTPlayer: function() {
        /*
        var iframe = document.getElementsByTagName('iframe')[0];
        iframe.postMessage('{"event":"command", "func":"pauseVideo", "args":""}', '*');
        */
        //document.getElementsByTagName('iframe')[0].postMessage('{"event":"command", "func":"pauseVideo", "args":""}', '*');
        //(document.getElementsByTagName('iframe')[0]).postMessage('{"event":"command", "func":"pauseVideo", "args":""}', '*');
        /*
        var div = document.getElementById("ytplayer");
        var iframe = div.getElementsByTagName("iframe")[0].contentWindow;
        //div.style.display = state == 'hide' ? 'none' : '';
        func = 'pauseVideo';
        iframe.postMessage('{"event":"command","func":"' + func + '","args":""}','*');
        */
        /*
        var div = document.getElementById("ytplayer");
        console.log(div); // null

        var div = this.getElementById("ytplayer"); // ERR:  "... this.getElementById is not a function"
        console.log(div);

        var div = this.$$("iframe").getElementById("ytplayer"); // ERR:  "... this.$$(...).getElementById is not a function"
        console.log(div);
        */
        // this.$.ytplayer_wrapper.postMessage('{"event":"command", "func":"pauseVideo", "args":""}', '*'); // ERR:  "... Cannot read property 'postMessage' of undefined"
        /*
				var vid = Polymer.dom(this.$$('.ytplayer_wrapper')).children[0];
				// var vid = Polymer.dom(this.$$('ytplayer_wrapper')).children[0];
        // vid.setAttribute('selected', false);
        console.log(vid); // <html lang="en"><head><meta ... </html>
        console.log(vid[0]); // undefined
        vid.postMessage('{"event":"command", "func":"pauseVideo", "args":""}', '*'); // ERR
        *//*
				var vid = Polymer.dom(this.$$('#ytplayer_wrapper')).children[0];
        console.log(vid); // <iframe ... </iframe>
        console.log(vid[0]); // undefined
        vid.postMessage('{"event":"command", "func":"pauseVideo", "args":""}', '*'); // ERR
        *//*
				var vid = Polymer.dom(this.$$('#ytplayer_wrapper')).children[0].contentWindow;
        console.log(vid); // <iframe ... </iframe>
        console.log(vid[0]); // undefined
        vid.postMessage('{"event":"command", "func":"pauseVideo", "args":""}', '*'); // Security ERR
        */
				var vid = Polymer.dom(this.$$('#ytplayer_wrapper')).children[0].contentWindow;
        console.log(vid);
        vid.postMessage('{"event":"command", "func":"pauseVideo", "args":""}', 'https://www.youtube.com');
        
      },

      // 3 Functions for setting the flags when arriving at a view.
      change2ViewChoose: function() {
        if (this.flagVideo_) this.pauseYTPlayer();
        this.flagList_ = true;
        this.flagVideo_ = false;
        this.flagNotes_ = false;
        ;
      },
      change2ViewWatch: function() {
        this.flagVideo_ = true;
        this.flagNotes_ = true;
        this.flagList_ = false;
        ;
      },
      change2ViewNotes: function() {
        if (this.flagVideo_) this.pauseYTPlayer();
        this.flagNotes_ = true;
        this.flagList_ = false;
        this.flagVideo_ = false;
        ;
      },

      attached: function() {
        this.APIKey_ = ""; // TODO: Replace with authentication key.
        this.change2ViewChoose();
        ;
      }

      // Desired Feature: Change rows of textarea based on view.
      //   rows="8" when watching, bigger when saving & loading.
    });
  </script>

</dom-module>